# Настройка SSH

SSH - лучший способ для управления удалённым сервером. Весь трафик между клиентом
и сервером надёжно шифруется, что исключает возможность несанкционированного перехвата 
данных. Так же SSH поддерживает авторизацию по публичным ключам без ввода пароля.
Ключ, в отличие от пароля, невозможно подобрать брутфорсом.

## Публичные ключи

Ваш публичный ключ по умолчанию находится в `~/.ssh/id_rsa.pub`.
Если его там нет, то сгенерируйте его с помощью следующей команды:

```
ssh-keygen
```

Когда ключ будет готов, выведите его в консль:

```
% cat ~/.ssh/id_rsa.pub 
ssh-rsa AAAAB3Nz***SWHbw== anton@home
```

Зайдите на удалённый сервер и создайте там файл `~/.ssh/authorized_keys`. Добавьте в него свой ключ.
Если всё сделано правильно, то следующий вход уже будет без пароля.

Если ключей несколько, то каждый ключ должен быть в новой строке.

## Авторизация только по публичным ключам без пароля

Установите следующие настройки в файле `/etc/ssh/sshd_config` как показано ниже: 

```
## Вход для root по публичным ключам (по умолчанию выключен)
PermitRootLogin without-password

## Авторизация пользователей по паролю (по умолчанию включена)
PasswordAuthentication no

## Авторизация по публичным ключам (по умолчанию включена)
RSAAuthentication yes
PubkeyAuthentication yes
```

И перегрузите сервис SSH с помощью команды `service ssh reload`. В результате
вход на сервер станет возможным только по публичному ключу.

## Смена порта

В файле `/etc/ssh/sshd_config` можно изменить порт, который слушает SSH-сервер:

```
## Порт (по умолчанию 22)
Port 3333
```

Это создаст проблемы для тех, кто будет сканировать ваш сервер. Но также это 
создаст некоторые проблемы и для вас, если вы используете репозитории git.

Чтобы избежать проблем с явным указанием порта для репозиториев, вы можете
указать его в файле `~/.ssh/config` следующим образом:

```
host pribora.info
    port 3333
```